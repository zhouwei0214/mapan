<!doctype html><html class="theme-next pisces use-motion"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.gmirror.org/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css"><meta name="keywords" content="论文,"><link rel="alternate" href="/atom.xml" title="马攀的博客" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2"><meta name="description" content="郑州大学西亚斯国际学院
本科毕业论文（设计）
题 目 交互式语音家居控制系统的设计
指导教师 周 伟 职称 讲 师
学生姓名 马 攀 学号 201310599440
专 业 通信工程 班级 通信工程1班
院 （系） 电子信息工程学院
完成时间 2017年3月
交互式语音家居控制系统的设计
摘 要
随着华为公司拿下5G控制信道eMBB场景编码方案，物联网的普及也距我们的生活越来越近，物联网已成为时"><meta property="og:type" content="article"><meta property="og:title" content="《交互式语音家居控制系统的设计》论文"><meta property="og:url" content="http://blog.mapan.win/2017/053.html"><meta property="og:site_name" content="马攀的博客"><meta property="og:description" content="郑州大学西亚斯国际学院
本科毕业论文（设计）
题 目 交互式语音家居控制系统的设计
指导教师 周 伟 职称 讲 师
学生姓名 马 攀 学号 201310599440
专 业 通信工程 班级 通信工程1班
院 （系） 电子信息工程学院
完成时间 2017年3月
交互式语音家居控制系统的设计
摘 要
随着华为公司拿下5G控制信道eMBB场景编码方案，物联网的普及也距我们的生活越来越近，物联网已成为时"><meta property="og:image" content="http://blog.mapan.win/media/e399373193d485edfe9d25e10563a4ff.jpg"><meta property="og:image" content="http://blog.mapan.win/media/9e8e259d64ff417853d3d0b4c24b579f.jpg"><meta property="og:image" content="http://blog.mapan.win/media/d57047487a397d7f186bb428cca685f0.jpg"><meta property="og:image" content="http://blog.mapan.win/media/bdc1ebd1282b210832138a0c83d7eabd.png"><meta property="og:image" content="http://blog.mapan.win/media/87d5fdcc3464f380d4ea8df4f2762401.jpg"><meta property="og:image" content="http://blog.mapan.win/media/91ed57c4e70b8e84d6656c0152d6117b.jpg"><meta property="og:image" content="http://blog.mapan.win/media/32af8b04582feaffea99af3a5b4c789e.jpg"><meta property="og:image" content="http://blog.mapan.win/media/2d99e9b147ae2c5ab29ad19a627fdfec.jpg"><meta property="og:image" content="http://blog.mapan.win/media/02cda0e54ee5f7e4949367126dda996d.jpg"><meta property="og:image" content="http://blog.mapan.win/media/c3bde77d767276b7e2a205c50b94af05.png"><meta property="og:image" content="http://blog.mapan.win/media/14dbb42dd3b26f84b83de26fcd39589e.jpg"><meta property="og:image" content="http://blog.mapan.win/media/8ebf02ae389ef277f555d6def51f5347.jpg"><meta property="og:image" content="http://blog.mapan.win/media/45a2918f21390fec81ad21a932ec9df9.jpg"><meta property="og:image" content="http://blog.mapan.win/media/b9652c63646c08a95a3eea6994d2ddf8.jpg"><meta property="og:image" content="http://blog.mapan.win/media/277008fd7937f25d273f19a206fdbf08.jpg"><meta property="og:image" content="http://blog.mapan.win/media/006bb858bcfbdf360789f3262a357ae5.gif"><meta property="og:image" content="http://blog.mapan.win/media/641740800ee9dfc4ebc2d83ab766df71.png"><meta property="og:image" content="http://blog.mapan.win/media/f7a9893707f30bb13889b299d7c20662.jpg"><meta property="og:image" content="http://blog.mapan.win/media/6347f14eecee2f629c5976b6069751bc.jpg"><meta property="og:image" content="http://blog.mapan.win/media/0f1b05554017bb430c2000a32de20d0d.jpg"><meta property="og:image" content="http://blog.mapan.win/media/27a8ecbae0871a2dc5da445c331116a1.jpg"><meta property="og:image" content="http://blog.mapan.win/media/a65d9d512dbe13bb74cf2f63f7c7012b.jpg"><meta property="og:image" content="http://blog.mapan.win/media/7e2a458fecebfa5fdd8408737a96f29a.jpg"><meta property="og:image" content="http://blog.mapan.win/media/50862b21ff143ef487c4417cc73dc1fe.jpg"><meta property="og:image" content="http://blog.mapan.win/media/de21a9d69a2b44c9ea9d945bf7d14348.jpg"><meta property="og:image" content="http://blog.mapan.win/media/6ac8c575c08630cd79fdf13398761ebe.jpg"><meta property="og:image" content="http://blog.mapan.win/media/fdb0fdad4fb930efd753af8c49575638.jpg"><meta property="og:image" content="http://blog.mapan.win/media/2118351f6b35d6e7841c80d4d1b97981.jpg"><meta property="og:image" content="http://blog.mapan.win/media/b0672234d6b7b1b6011fb752cd9b8329.jpg"><meta property="og:image" content="http://blog.mapan.win/media/d44402ba4e1cbd509608d6998870d380.jpg"><meta property="og:image" content="http://blog.mapan.win/media/20c83d68107fc02b9046a669f076e40d.jpg"><meta property="og:image" content="http://blog.mapan.win/media/783c6f0e88958f6e97aa74c5930f500a.jpg"><meta property="og:image" content="http://blog.mapan.win/media/4edd522ab4184a993dc2c2038ddbcc06.png"><meta property="og:updated_time" content="2017-05-15T13:17:53.088Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="《交互式语音家居控制系统的设计》论文"><meta name="twitter:description" content="郑州大学西亚斯国际学院
本科毕业论文（设计）
题 目 交互式语音家居控制系统的设计
指导教师 周 伟 职称 讲 师
学生姓名 马 攀 学号 201310599440
专 业 通信工程 班级 通信工程1班
院 （系） 电子信息工程学院
完成时间 2017年3月
交互式语音家居控制系统的设计
摘 要
随着华为公司拿下5G控制信道eMBB场景编码方案，物联网的普及也距我们的生活越来越近，物联网已成为时"><meta name="twitter:image" content="http://blog.mapan.win/media/e399373193d485edfe9d25e10563a4ff.jpg"><script type="text/javascript" id="hexo.configuration">var NexT=window.NexT||{},CONFIG={scheme:"Pisces",sidebar:{position:"right",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:"undefined",author:"博主"}}</script><link rel="canonical" href="http://blog.mapan.win/2017/053.html"><title> 《交互式语音家居控制系统的设计》论文 | 马攀的博客</title></head><body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans"><div class="container one-collumn sidebar-position-right page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="//schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="http://www.mapan.win" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">马攀的博客</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">学习之路 漫漫其修远兮</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br> 关于</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-board"><a href="/board" rel="section"><i class="menu-item-icon fa fa-fw fa-soccer-ball-o"></i><br> 留言</a></li><li class="menu-item menu-item-book"><a href="/book" rel="section"><i class="menu-item-icon fa fa-fw fa-book"></i><br> 读书</a></li><li class="menu-item menu-item-show"><a href="http://shows.mapan.win" target="_blank" rel="section"><i class="menu-item-icon fa fa-fw fa-tachometer"></i><br> 精选</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="//schema.org/Article"><header class="post-header"><h1 class="post-title" itemprop="name headline"> 《交互式语音家居控制系统的设计》论文</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time itemprop="dateCreated" datetime="2017-04-09T16:22:00+08:00" content="2017年04月09日">2017年04月09日</time></span> <span class="post-category">&nbsp; | &nbsp;<span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/学习/" itemprop="url" rel="index"><span itemprop="name">学习</span></a></span></span> &nbsp; | &nbsp;<span class="page-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body" itemprop="articleBody"><script src="/assets/js/DPlayer.min.js"></script><p><strong>郑州大学西亚斯国际学院</strong></p><p>本科毕业论文（设计）</p><p>题 目 <em>交互式语音家居控制系统的设计</em></p><p>指导教师 <em>周 伟</em> 职称 <em>讲 师</em></p><p>学生姓名 <em>马 攀</em> 学号 <em>201310599440</em></p><p>专 业 <em>通信工程</em> 班级 <em>通信工程1班</em></p><p>院 （系） <em>电子信息工程学院</em></p><p>完成时间 <em>2017年3月</em></p><p>交互式语音家居控制系统的设计</p><p>摘 要</p><p>随着华为公司拿下5G控制信道eMBB场景编码方案，物联网的普及也距我们的生活越来越近，物联网已成为时下研究热门领域。而物联网最早的应用是在智能家居方面。在手机领域，苹果siri的出现颠覆人们对手机的概念，从键盘机到触屏机再到现在的语音交互。本文介绍的便是一种新型的语音交互式智能家居解决方案，它融合了语音交互和智能家居两个领域的特点，给人们一种全新的体验。是未来智能家居发展的一个重要方向。本设计使用STC公司增强型12单片机作为主控制器，使用了语音识别、MP3播放、时钟、蓝牙、LCD显示屏、继电器等模块，实现了人机对话、无线控制、手机控制、语音报时、时间温度显示、闹钟等功能。充分体现了各个模块之间的相互协作，外观精美，操作方便，市场前景广阔，具有很大的研发意义。</p><p>关键词 单片机/智能家居/无线控制/语音交互</p><p><strong>DESIGN OF VOICE INTERACTIVE</strong></p><p><strong>HOME CONTROL SYSTEM</strong></p><p><strong>ABSTRACT</strong></p><p>With the Huawei won the 5G control channel eMBB scene encoding scheme, the<br>popularity of Internet of things is also closer to our lives, Internet of Things<br>has become a hot research field nowadays. The Internet of things is the first<br>application in the smart home. In the field of mobile phones, Apple siri<br>subversion of the emergence of the concept of mobile phones, from the keyboard<br>to the touch screen machine to the current voice interaction. This article<br>describes a new type of voice interactive smart home solutions, which combines<br>the two areas of voice interaction and intelligent home features, giving people<br>a new experience. Is the future of intelligent home development is an important<br>direction. The design uses STC Enhanced 12 single-chip as the main controller,<br>using the voice recognition, MP3, clock, Bluetooth, LCD screen, relays and other<br>modules to achieve human-computer dialogue, wireless control, mobile control,<br>voice timekeeping, time Temperature display, alarm clock and other functions.<br>Fully embodies the mutual cooperation between the various modules, the<br>appearance of fine, easy to operate, the market prospect is broad, has great<br>significance for research and development.</p><p><strong>KEY WORDS</strong> MCU<strong>,</strong>voice interactive,smart home,wireless control</p><p>目 录</p><p><a href="#绪论">中文摘要 Ⅰ</a></p><p><a href="#绪论">英文摘要 Ⅱ</a></p><p><a href="#研究现状与发展趋势">1.1 研究现状与发展趋势 1</a></p><p><a href="#研究背景和设计目的">1.2 研究背景和设计目的 1</a></p><p><a href="#总体设计方案">2 总体设计方案 1</a></p><p><a href="#设计要求">2.1 设计要求 1</a></p><p><a href="#总体方案">2.2 总体方案 1</a></p><p><a href="#结构框图">2.3 结构框图 2</a></p><p><a href="#硬件设计">3 硬件设计 3</a></p><p><a href="#主控制端">3.1 主控制端 3</a></p><p><a href="#主控制器">3.1.1 主控制器 3</a></p><p><a href="#mp3播放模块">3.1.2 MP3播放模块 4</a></p><p><a href="#蓝牙模块">3.1.3 蓝牙模块 4</a></p><p><a href="#时钟模块">3.1.4 时钟模块 5</a></p><p><a href="#语音识别模块">3.1.5 语音识别模块 6</a></p><p><a href="#功放模块">3.1.6 功放模块 7</a></p><p><a href="#电源模块">3.1.7 电源模块 7</a></p><p><a href="#串口复用模块">3.1.8 串口复用模块 8</a></p><p><a href="#从控制端">3.2 从控制端 8</a></p><p><a href="#继电器模块">3.2.1 继电器模块 8</a></p><p><a href="#液晶显示模块">3.2.2 液晶显示模块 9</a></p><p><a href="#时钟模块-1">3.2.3 时钟模块 10</a></p><p><a href="#温度传感器">3.2.4 温度传感器 11</a></p><p><a href="#软件设计">4 软件设计 12</a></p><p><a href="#主控制端软件设计">4.1 主控制端软件设计 12</a></p><p><a href="#移动端主程序">4.1.1 移动端主程序 12</a></p><p><a href="#循环模式">4.1.2 循环模式 12</a></p><p><a href="#口令模式">4.1.3 口令模式 13</a></p><p><a href="#报时模式">4.1.4 报时模式 14</a></p><p><a href="#从控制端软件设计">4.2 从控制端软件设计 15</a></p><p><a href="#固定端主程序">4.2.1 固定端主程序 15</a></p><p><a href="#按键扫描程序">4.2.2 按键扫描程序 15</a></p><p><a href="#闹钟检测程序">4.2.3 闹钟检测程序 16</a></p><p><a href="#继电器控制程序">4.2.4 继电器控制程序 16</a></p><p><a href="#lcd显示程序">4.2.5 LCD显示程序 17</a></p><p><a href="#整体调试与测试">5 整体调试与测试 18</a></p><p><a href="#调试过程">5.1 调试过程 18</a></p><p><a href="#模块的测试">5.2 模块的测试 19</a></p><p><a href="#手机app适配">5.3 手机APP适配 19</a></p><p><a href="#原理图和pcb图">5.4 原理图和PCB图 19</a></p><p><a href="#结论">结论 21</a></p><p><a href="#致-谢">致谢 21</a></p><p><a href="#参考文献">参考文献 22</a></p><p><a href="#附录">附录 22</a></p><h1 id="绪论"><a href="#绪论" class="headerlink" title="绪论"></a>绪论</h1><h2 id="研究现状与发展趋势"><a href="#研究现状与发展趋势" class="headerlink" title="研究现状与发展趋势"></a>研究现状与发展趋势</h2><p>随着5G通信技术的发展，物联网进入千家万户已经近在咫尺。智能家居作为物联网产品的代表产品现在已经变得炙手可热,本设计的灵感来自于智能手机的语音助手和智能家居的结合，借助语音识别技术来实现人机交互，通过物联网技术进而控制家用电器，大大的简化了传统的用电器控制方式，在很大程度上方便了人们的生活。</p><p>近年来，以智能插座、红外遥控、智能门磁、空气检测为代表的“智能产品”出现，以及在电商业务渠道和公共销售平台中，大大降低了用户使用智能家居产品的成本门槛。随着控制技术和互动方式的不断发展，<a href="http://smarthome.ofweek.com/" target="_blank" rel="external">智能家居</a>控制方式也出现出多元化发展的态势。在传统产品智能升级的过程中，APP成为智能化的重要要素，也开始被众多终端用户认可。此外，成熟的语音控制与传感器技术也为广大用户提供了无需手动操作的新兴控制方式。特别是针对于老年和儿童用户，在简单便捷操控方面有着特殊的优势。</p><h2 id="研究背景和设计目的"><a href="#研究背景和设计目的" class="headerlink" title="研究背景和设计目的"></a>研究背景和设计目的</h2><p>当前的语音提示类产品种类繁多，但大都是单方向的，如电动车语音提示，充电器语音提示等由设备直接播放设置好的语音，并不能实现人机对话的效果。在物联网即将盛行的当下，出现了各种新颖的操控方式。语音交互的操作方式作为其中的一个分支，具有很大的发展前景。</p><p>为了检验在本科阶段学习的知识与技能，通过毕业设计的形式对在校期间所学内容进行检查。选择这个题目，一方面是为了检验所学知识漏洞巩固所学内容，另一方面为了提高个人就业竞争力。语音交互的家居控制系统为以后的物联网发展提供了新的思路。</p><h1 id="总体设计方案"><a href="#总体设计方案" class="headerlink" title="总体设计方案"></a>总体设计方案</h1><h2 id="设计要求"><a href="#设计要求" class="headerlink" title="设计要求"></a>设计要求</h2><p>使用单片机为主控制器设计一套语音交互家居控制系统，具有如下功能：</p><p>a.控制端与被控制端通过无线通信；</p><p>b.语音播报当前时间温度，掉电走时，操作简单便捷；</p><p>c.可以进行简单人机对话，包括控制指令、诵读古诗、播放音乐等等；</p><p>d.控制端轻巧可移动，可充电，待机时间长；</p><p>e.可以通过语音来控制家电的开关；</p><p>f.被控制端可显示时间温度，可设定定时闹钟。</p><h2 id="总体方案"><a href="#总体方案" class="headerlink" title="总体方案"></a>总体方案</h2><p>方案一：使用两个STM32作为主控制器，主从机分别采用LD3320<br>语音识别模块，DS1302时钟芯片，HC-05蓝牙模块，串口MP3播放模块，LCD触摸屏彩屏等实现相应的功能。优点是可配置方案多，效果理想，能较为完善的实现相应功能。缺点是系统庞大，开发难度大，研发周期长，价格高昂，稳定性不易控制。</p><p>方案二：使用增强型51单片机作为主控制器，主从机分别采用语音识别协处理模块，DS3231时钟模块、蓝牙模块、LCD1602液晶屏模块、串口MP3播放模块、DS18B20温度传感器等模块实现相应的功能。优点是软硬件成熟，移植性强，价格合理易接受，硬件资源刚好满足系统要求，研发周期短，难度相对适中，后期维护简单。缺点是解密容易，内部资源刚好满足当前要求，后期扩展性不足。</p><p>方案三：使用Arduino UNO作为主控制器，Arduino Micro<br>作为从控制器,使用2.4G模块进行通信，加上语音识别模块、时钟模块、MP3播放模块、温度传感器等模块来实现相应功能。此方案有点是硬件搭建简单，软件易编写调试，后期维护相对方便。缺点是Arduino模块价格高昂，Aduino定位于硬件积木、电子玩具；不适用于用来做稳定性要求很高的产品设计。</p><p>由于我对51单片机平台的周围器件、模块操作的使用比较熟悉。C语言的效率高、移植性强。我对C语言也比较熟练，综上所述，通过51单片机+外围模块+C语言编程的方案已经完全可以实现所需的功能。经过权衡两种方案的优缺点，我选择了方案二作为本次设计的最终方案。</p><h2 id="结构框图"><a href="#结构框图" class="headerlink" title="结构框图"></a>结构框图</h2><p>总体设计分为两部分，第一部分是主控制端，也称可移动端，主要负责人机对话，语音报时，无线控制等功能，其原理框图如图所示。第二部分是从控制端，也称为固定端，主要负责时间温度显示，控制继电器开合，闹钟提醒等功能。主控制端通过蓝牙与从控制端通信，继而以语音的形式通过无线向从控制端发送指令，来实现控制用电器的功能。图2-1是主控制端的原理框图。图2-2是从控制端的原理框图。</p><p><img src="media/e399373193d485edfe9d25e10563a4ff.jpg" alt="2017-02-23\_212511"></p><p><img src="media/9e8e259d64ff417853d3d0b4c24b579f.jpg" alt="2017-02-23\_214227"></p><p>图2-1 图2-2</p><h1 id="硬件设计"><a href="#硬件设计" class="headerlink" title="硬件设计"></a>硬件设计</h1><h2 id="主控制端"><a href="#主控制端" class="headerlink" title="主控制端"></a>主控制端</h2><h3 id="主控制器"><a href="#主控制器" class="headerlink" title="主控制器"></a>主控制器</h3><p><img src="media/d57047487a397d7f186bb428cca685f0.jpg" alt=""></p><p>图3-1</p><p>本设计需要使用多个标准串口，内部程序空间大，处理速度快的处理器，因此选用了STC公司生产的12C5A60S2单片机。该处理器为增强型8051单时钟周期(1T)的单片机，具有两个串口，时钟频率0-35MHz，工作电压3.5-5.5V，程序存储器高达60KB，指令完全兼容传统8051，内部集成MAX810专用复位电路，2路PWM，8路AD转换，在本设计中，主控部分为了减小电路体积，采用了贴片式LQFP-44封装，从控制部分采用双列直插DIP-40封装。为了使用标准串口通信，需要产生标准的波特率，故选用22.1184MHz的晶体振荡器。图3-1是该主控芯片LQFP封装的引脚示意图。</p><h3 id="MP3播放模块"><a href="#MP3播放模块" class="headerlink" title="MP3播放模块"></a>MP3播放模块</h3><p><img src="media/bdc1ebd1282b210832138a0c83d7eabd.png" alt=""></p><p>图3-2</p><p>为了实现语音交互，需要可以播放录音的MP3播放器模块，选用了YX-5200串口通信的MP3播放器模块。YX-5200是一颗高保真MP3解码芯片，集成了MP3和WAV两种格式的解码，支持TF-CARD，只需要简单的串口指令即可完成控制，成本低，控制方便，稳定性高，性价比高。图3-2是MP3模块的引脚示意图。</p><p>该模块的控制方式：异步串口通讯，9600bps波特率，串口控制指令如表3-3所示：</p><table><thead><tr><th>格式：</th><th>\$S VER Len CMD Feedback para1 para2 shcksum \$0</th><th></th><th></th></tr></thead><tbody><tr><td>起始位</td><td>\$S</td><td>起始位0X7E</td><td>每条命令均以\$开头，即0X7E</td></tr><tr><td>数据位</td><td>VER</td><td>版本</td><td>版本信息，默认0X10</td></tr><tr><td></td><td>Len</td><td>数据位字节个数</td><td>校验和不计算在内</td></tr><tr><td></td><td>CMD</td><td>命令字</td><td>表示具体的操作，比如播放/暂停等等</td></tr><tr><td></td><td>Feedback</td><td>命令反馈</td><td>是否需要反馈信息，1反馈，0不反馈</td></tr><tr><td></td><td>para1</td><td>参数1</td><td>查询的数据高字节(比如歌曲序号)</td></tr><tr><td></td><td>para2</td><td>参数2</td><td>查询的数据低字节</td></tr><tr><td>校验位</td><td>shcksum</td><td>校验位(高八位和低八位)</td><td>累加和校验(不计起始位)</td></tr><tr><td>结束位</td><td>\$0</td><td>结束位0XEF</td><td>每条命令均以0结束，即0xEF</td></tr></tbody></table><p>表3-3</p><p>校验和的计算方法为：65536减数据位之和。其中Busy位是判忙标志位，在MP3播放器工作时，不能和外接进行通信，对外表现出BUSY位为低电平。MCU若要对其控制，必须等待标志位置高再发送指令。</p><h3 id="蓝牙模块"><a href="#蓝牙模块" class="headerlink" title="蓝牙模块"></a>蓝牙模块</h3><p>无线通信选用一对蓝牙HC-05模块，使用前要首先进入AT模式，进行主从角色、波特率、绑定地址等配置。在上电的时候同时将按键按下，上电后自动进入AT指令模式，默认波特率为38400bps，可以通过串口发送相应指令对，蓝牙名称、配对密码、绑定地址、工作模式进行配置。在本设计中，主控制端需配置为主工作模式，从控制端需要配置为从工作模式，工作波特率配置为9600bps，绑定地址需填写对方MAC地址。图3-4是蓝牙HC-05模块的原理图。</p><p><img src="media/87d5fdcc3464f380d4ea8df4f2762401.jpg" alt=""></p><p>图3-4</p><p>配置完成后连接到单片机的TXD和RXD端口即可使用。模块之间的通信使用标准串口协议，波特率为9600bps，本模块主要用来实现语音指令对固定端的控制。控制指令如表3-5。</p><table><thead><tr><th>起始位</th><th>数据位</th><th>结束位</th><th>功能</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>0x55</td><td>0x53</td><td>0x30</td><td>0x30</td><td>0x32</td><td>0x7e</td><td>0x66</td><td>闭合继电器1</td></tr><tr><td>0x55</td><td>0x53</td><td>0x31</td><td>0x30</td><td>0x32</td><td>0x7e</td><td>0x66</td><td>断开继电器1</td></tr><tr><td>…</td><td>…</td><td>…</td><td>…</td><td>…</td><td>…</td><td>…</td><td>…</td></tr><tr><td>0x55</td><td>0x53</td><td>0x31</td><td>0x30</td><td>0x38</td><td>0x7e</td><td>0x66</td><td>打开红色LED</td></tr></tbody></table><p>表3-5</p><p>发送端和接收端只需要遵循这个协议即可完成互相通信，由于是近距离通信，信号质量较高，实际在室温10米距离的条件下进行测试，工作正常，极少产生误码现象，所以没有进行数据校验。</p><h3 id="时钟模块"><a href="#时钟模块" class="headerlink" title="时钟模块"></a>时钟模块</h3><p>本设计需要选用一个低成本、高精度、外设简单的实时时钟芯片，需要实现掉电走时，功耗极低的时钟芯片。经过对比选择了Maxim公司生产的DS3231时钟芯片。该芯片价格低、精度高、具有温度补偿，通过I2C与外界通信，可外接纽扣电池，实现掉电走时功能。图3-6是DS3231芯片的标准硬件连接图。</p><p><img src="media/91ed57c4e70b8e84d6656c0152d6117b.jpg" alt=""></p><p>图3-6</p><p>DS3231与单片机通信时采用标准I2C协议。控制信号分为起始信号和结束信号，在时钟线为高电平时，数据线上的下降沿为I2C起始信号，上升沿为I2C结束信号。在传输数据时，当时钟线为高电平，数据线上的电平必须保持稳定，否则会被认为是控制信号。在单片机与DS3231通信时，首先发送起始信号，再发送器件地址和读写位，然后数据传送开始，待数据传送完成后发送结束信号。I2C通信协议如图3-7所示。</p><p><img src="media/32af8b04582feaffea99af3a5b4c789e.jpg" alt=""></p><p>图3-7</p><p>DS3231的IIC器件地址是1101000，在使用时，只需写入或者读取相应寄存器内的值即可。通过I2C协议使用非常便捷，在成库中添加IIC的库文件，然后主函数中调用即可实现读取和写入数据的目的。表3-8是DS3231的常用寄存器配置。</p><table><thead><tr><th>地址</th><th>BIT7</th><th>BIT6</th><th>BIT5</th><th>BIT4</th><th>BIT3</th><th>BIT2</th><th>BIT1</th><th>BIT0</th><th>功能</th><th>范围</th></tr></thead><tbody><tr><td>00h</td><td>0</td><td>秒钟(十位)</td><td>秒钟</td><td>秒钟</td><td>00-59</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>01h</td><td>0</td><td>分钟(十位)</td><td>分钟</td><td>分钟</td><td>00-59</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>02h</td><td>0</td><td>12/24</td><td>AM/PM</td><td>小时</td><td></td><td>小时</td><td>00-23</td><td></td><td></td><td></td></tr><tr><td>03h</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>星期</td><td>星期</td><td>1-7</td><td></td><td></td></tr><tr><td>04h</td><td>0</td><td></td><td>日期(十位)</td><td>日期</td><td>日期</td><td>01-31</td><td></td><td></td><td></td><td></td></tr><tr><td>05h</td><td>世纪</td><td>0</td><td>0</td><td>月份(十位)</td><td>月份</td><td>月/世纪</td><td>01-12 世纪</td><td></td><td></td><td></td></tr><tr><td>06h</td><td>年份(十位)</td><td>年份</td><td>年</td><td>00-99</td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><p>表3-8</p><h3 id="语音识别模块"><a href="#语音识别模块" class="headerlink" title="语音识别模块"></a>语音识别模块</h3><p>采用32位RISC内核协处理器，工作频率96MHz，内建96KbSRAM。可进行非特定人语音识别，可对用户的语音进行识别，支持中文音素识别，可任意指定中文识别词条(小于8个字)。采用标准UART接口与主控通信。模块使用19200波特率与单片机进行串口通信。在单片机配置时流程如下：</p><ol><li><p>上电，等待模块初始化完成。</p></li><li><p>发送初始化命令，等待回传数据，握手成功。如果30秒内无命令则自动休眠。</p></li><li><p>根据需要配置麦克风灵敏度。</p></li><li><p>根据需要配置噪声门限。</p></li><li><p>配置识别命令组。</p></li><li><p>启动一次识别，等待识别结果。</p></li><li><p>根据识别结果进行处理，或者读取候选识别结果进行处理。</p></li><li><p>重复e-g或f-g步骤，实现语音互动。</p></li><li><p>退出识别。</p></li><li><p>进入低功耗模式。</p></li></ol><p>常用命令如表3-9所示。</p><table><thead><tr><th>功能</th><th>主机=>>从机</th><th>从机=>>主机</th><th>备注</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>初始化</td><td>0xa0</td><td>0xa0</td><td>0xa0</td><td>0x50</td><td>0x50</td><td>0x11</td><td>重新初始化</td></tr><tr><td>配置识别组</td><td>0xa9</td><td>0xLL</td><td>0xHH</td><td>0x59</td><td>0xll</td><td>0xhh</td><td>配置识别组0xHHLL</td></tr><tr><td>启动一次识别</td><td>AA</td><td>LL</td><td>HH</td><td>0x5a</td><td>0xll</td><td>0xhh</td><td>返回识别结果 0xhhll</td></tr><tr><td>启动连续识别</td><td>0xab</td><td>0xab</td><td>0x00</td><td>0x5b</td><td>0xll</td><td>0xhh</td><td>返回识别结果0xhhll</td></tr><tr><td>退出识别</td><td>0xac</td><td>0xac</td><td>0x00</td><td>0x5c</td><td>0x00</td><td>0x00</td><td>退出识别，等待命令</td></tr><tr><td>进入休眠</td><td>0xae</td><td>0xae</td><td>0x00</td><td>0x5e</td><td>0x00</td><td>0x00</td><td>进入低功耗模式</td></tr></tbody></table><p>表3-9</p><h3 id="功放模块"><a href="#功放模块" class="headerlink" title="功放模块"></a>功放模块</h3><p>功放模块使用D类立体声音频功放芯片PAM8403，相对于AB类功放来说，D类功放具有效率极高，体积小，可靠性高等优点。采用新型无耦合输出及无低通滤波电路的架构，可在4欧负载和5V电源条件下，提供高达3W的功率。D类功放又称为数字功放，把输入信号输入比较器的反相接入端，三角波信号接入正向接入端，比较器输出既为脉宽调制(PDM)的音频信号，把PDM信号放大为高电压大电流后，经过解调(通过低通滤波器)后即可驱动扬声器发声。图3-10为PAM8403的调制解调原理图。图3-11是PAM8403的典型应用电路。</p><p><img src="media/2d99e9b147ae2c5ab29ad19a627fdfec.jpg" alt="D"></p><p><img src="media/02cda0e54ee5f7e4949367126dda996d.jpg" alt="timg"></p><p>图3-10 图3-11</p><h3 id="电源模块"><a href="#电源模块" class="headerlink" title="电源模块"></a>电源模块</h3><p>电源部分为一节18650锂电池和一个boost升压电路组成。Ui为锂电池端，Uo为电压输出端，T1为开关三极管。当T1闭合时，输入电压流过电感，电感上的电流以一定的比率线性增加，这个比率和电感的大小有关。随着电感电流的增加，电感储存能量。当T1断开时，由于电感上的电流不能跃变，而是由充磁完毕时候的电压缓慢的降为零，由于原来的电路已经断开，于是只能通过新的电路进行放电，即电感对电容进行充电，电容两端电压升高，此时电压已经高于输入电压。当开关管T1的开关频率足够高，C的容量足够大时，就可以在输出端Uo输出一个高于输入电压并且持续的电流。Boost升压的基本原理如图3-12。</p><p><img src="media/c3bde77d767276b7e2a205c50b94af05.png" alt="1-15110Z94345146"></p><p>图3-12</p><h3 id="串口复用模块"><a href="#串口复用模块" class="headerlink" title="串口复用模块"></a>串口复用模块</h3><p>由于主控制端需要通过标准串口与MP3语音播放模块、语音识别模块和蓝牙模块进行通信，但是单片机只有两个串口，所以需要采用串口复用。本设计选用了CD4052模拟开关进行复用，A和B是控制端，X和Y是输入端，通过A和B的不同取值，来改变接通的通道。在实际使用过程中，MP3语音播放模块使用通道4，蓝牙HC-05使用通道2。剩余的通道1和通道3未使用。在以后功能更新时可以扩展更多的外设。图3-13是CD4052的功能逻辑图，表3-14是CD4052的真值表。</p><table><thead><tr><th>INHIBIT</th><th>B</th><th>A</th><th>接通</th><th>通道</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td><td>X0,Y0</td><td>通道1</td></tr><tr><td>0</td><td>0</td><td>1</td><td>X1,Y1</td><td>通道2</td></tr><tr><td>0</td><td>1</td><td>0</td><td>X2,Y2</td><td>通道3</td></tr><tr><td>0</td><td>1</td><td>1</td><td>X3,Y3</td><td>通道4</td></tr><tr><td>1</td><td>X</td><td>X</td><td>None</td><td>未接通</td></tr></tbody></table><p><img src="media/14dbb42dd3b26f84b83de26fcd39589e.jpg" alt=""></p><p>图3-13 表3-14</p><h2 id="从控制端"><a href="#从控制端" class="headerlink" title="从控制端"></a>从控制端</h2><h3 id="继电器模块"><a href="#继电器模块" class="headerlink" title="继电器模块"></a>继电器模块</h3><p>继电器部分有四组光耦隔离继电器，在实际电路当中分别定义了台灯、电视、热水器、风扇这四个用电器。每组各有一个DP817光耦隔离芯片和额定电压为5V的继电器。光耦隔离可以使输入输出互相隔离，电信号单向传输，具有良好的绝缘能力和抗干扰能力。在外接高电压大电流用电器时候，不会由于电流纹波影响控制电路。图3-15是一组继电器的原理图。</p><p><img src="media/8ebf02ae389ef277f555d6def51f5347.jpg" alt="2017-03-26\_223825"></p><p>图3-15</p><h3 id="液晶显示模块"><a href="#液晶显示模块" class="headerlink" title="液晶显示模块"></a>液晶显示模块</h3><p>为了显示时间和温度，闹钟等信息。选择了应用广泛，稳定可靠的HJ1602液晶显示屏幕，</p><p>HJ1602市一中工业支付型液晶，能够显示16×2个字符（16列2行）。可以通过程序自由控制显示内容、控制亮度和对比度，使用十分方便。该功能模块共有16个引脚，引脚功能如图3-16所示。</p><p><img src="media/45a2918f21390fec81ad21a932ec9df9.jpg" alt=""></p><p>表3-16</p><p>在实际使用过程中，D0-D7共计8个数据引脚接到单片机的P0接口上，RS、R/W、E三个控制引脚接到P14、P15和P16上。使用并行控制的方法，写时序要求首先RS电平变化时刻，R/W有下降沿，在E使能线拉高之后，一次性写入数据线上的八位数据，写入完毕后E使能拉低。写操作时序如图3-17所示。</p><p><img src="media/b9652c63646c08a95a3eea6994d2ddf8.jpg" alt=""></p><p>图3-17</p><p>读时序和写时序类似，首先RS线电平变化时刻，R/W有一个上升沿，然后E使能线拉高并保持Tpw时间段，最后读取数据线上的八位数据。读操作时序如图3-18所示。</p><p><img src="media/277008fd7937f25d273f19a206fdbf08.jpg" alt=""></p><p>图3-18</p><h3 id="时钟模块-1"><a href="#时钟模块-1" class="headerlink" title="时钟模块"></a>时钟模块</h3><p>从价格成本和使用成本的角度来考虑，从控制部分采用了DS1302时钟芯片。DS1302时钟应用广泛，现有资料比较多，出现问题容易解决，仅需要3个GPIO引脚即可控制，可外接备用电池，实现掉电走时。本设计采用8-pin<br>SOPs封装，仅需少量外围器件即可和单片机匹配实现时钟的功能。图x是DS1302实时时钟标准接线图，其中需要外接32.768KHz的晶振，控制引脚必须加外部上拉电阻。图3-19是DS1302时钟的标准硬件连接图。</p><p><img src="media/006bb858bcfbdf360789f3262a357ae5.gif" alt=""></p><p>图3-19</p><p>在使用方面，是采用串行控制的方法，首先RST置高，随着时钟线SCLK信号的变化，在时钟线上升沿时刻传输控制位数信号，在时钟线下降沿时刻传输数据位信号。图3-20是DS1302的读写时序图。</p><p><img src="media/641740800ee9dfc4ebc2d83ab766df71.png" alt=""></p><p>图3-20</p><h3 id="温度传感器"><a href="#温度传感器" class="headerlink" title="温度传感器"></a>温度传感器</h3><p>在从控制端，需要温度传感器来采集环境温度，把温度信息发送给单片机并显示在LCD屏幕上，因此选用了较为常用的温度传感器芯片DS18B20。该芯片抗干扰能力强，它的核心功能是它可以通过单总线通信直接读取出温度的数字信号，封装大小和普通三极管一致。DS18B20的内部结构如图3-21所示。</p><p><img src="media/f7a9893707f30bb13889b299d7c20662.jpg" alt=""></p><p>图3-21</p><h1 id="软件设计"><a href="#软件设计" class="headerlink" title="软件设计"></a>软件设计</h1><h2 id="主控制端软件设计"><a href="#主控制端软件设计" class="headerlink" title="主控制端软件设计"></a>主控制端软件设计</h2><h3 id="移动端主程序"><a href="#移动端主程序" class="headerlink" title="移动端主程序"></a>移动端主程序</h3><p>本设计的主控制端有三种工作模式，分别是循环模式，口令模式和报时模式。可以通过按键来切换三种工作模式，开机默认是循环模式。开机后首先进行每个模块初始化工作，完成初始化后，进入循环模式并开始检测语音、进行识别，然后判断模式(mode)标志位，检测完成后进入相应的子程序，播放相应的语音或者对相应模块进行操作。图4-1是主程序的流程图。</p><p><img src="media/6347f14eecee2f629c5976b6069751bc.jpg" alt=""></p><p>图4-1</p><h3 id="循环模式"><a href="#循环模式" class="headerlink" title="循环模式"></a>循环模式</h3><p>循环模式是常用的工作模式，即人机对话的模式。在循环模式下能够连续的和人进行逻辑交流。首先识别标志位(flag)是否置一，识别标志位的作用是判断是否识别到了有效信息。如果标志位置一就翻转标志位，然后判断语音识别的结果，和设定的程序进行比较，如果符合则操作MP3模块播放相对应的语音或者蓝牙发送相应的指令，否则跳出本次循环。MP3模块播放时，忙标志位(busy)为0，当播放完成后忙标志位(busy)为1。在主程序执行时要等待MP3模块播放完成之后再进行后续操作，所以要进行判忙操作。MP3模块和蓝牙模块完成本次循环后，进入到下一次检测当中，重复检测下一次识别。通过不停地识别、判断和播放语音，这样循环实现了人机对话的功能。可以通过按键切换到循环模式，循环模式的程序流程图如图4-2所示</p><p><img src="media/0f1b05554017bb430c2000a32de20d0d.jpg" alt=""></p><p>图4-2</p><h3 id="口令模式"><a href="#口令模式" class="headerlink" title="口令模式"></a>口令模式</h3><p>口令模式是为了在嘈杂环境下，减少误识别而设定的模式。在口令模式下，需要每次说出正确的口令才可以继续识别语音。同循环模式，首先进入检测识别标志位，然后循环检测口令，只有当识别到正确口令后，程序才进入到二次识别检测的循环，然后播放语音和执行相应操作，否则一直在循环检测口令。在本设计中，口令是“天王盖地虎”，在被正确识别口令后会收到回复“煎饼两块五”的回复，下一次即可识别正常的语音，然后执行对应的操作。在完成一次正确语音识别后，会跳出本次循环，再次检测口令，如此循环即实现了口令模式的功能。在使用中可以通过按键切换到口令模式，口令模式的程序流程图如图4-3所示。</p><p><img src="media/27a8ecbae0871a2dc5da445c331116a1.jpg" alt=""></p><p>图4-3</p><h3 id="报时模式"><a href="#报时模式" class="headerlink" title="报时模式"></a>报时模式</h3><p>报时模式即通过语音组合播放，播出当前的时间。进入报时模式有两种方式，语音方式和按键方式。通过语音“现在几点了？”、“现在时间是？”来进入报时模式，或者直接按下对应的按键进入报时模式。</p><p>进入报时模式后，单片机通过iic协议读取DS3231时钟芯片里相日期对应寄存器里的数值，并存储到cache缓存中，然后播放相应的日期语音文件。再读取时间相对应寄存器里的数值，存储到cache缓存，播放相应时间语音。播放完毕后会跳出报时模式，自动进入循环模式。报时模式的程序流程图如图4-4所示。</p><p><img src="media/a65d9d512dbe13bb74cf2f63f7c7012b.jpg" alt=""></p><p><img src="media/7e2a458fecebfa5fdd8408737a96f29a.jpg" alt="C:\\Users\\MaPan\\AppData\\Local\\Microsoft\\Windows\\INetCache\\Content.Word\\2017-04-08\_160303.jpg"></p><p>图4-4 图4-5</p><h2 id="从控制端软件设计"><a href="#从控制端软件设计" class="headerlink" title="从控制端软件设计"></a>从控制端软件设计</h2><h3 id="固定端主程序"><a href="#固定端主程序" class="headerlink" title="固定端主程序"></a>固定端主程序</h3><p>从控制端又称为固定端，它可以对用电器的开关进行控制，显示时间温度，设定闹钟等功能。主控制端通过蓝牙HC-05模块与从控制端进行通信和控制，实现无线控制继电器的开关，进而可以控制用电器的开关。系统上电后，依次进入LCD初始化程序、DS1302初始化程序、串口中断初始化程序，然后开始扫描按键、检测闹钟、显示操作、检测继电器指令等操作的大循环。图4-5是从控制端的程序流程图。</p><h3 id="按键扫描程序"><a href="#按键扫描程序" class="headerlink" title="按键扫描程序"></a>按键扫描程序</h3><p>固定段为了方便调整时间和闹钟，设定了四个按键，功能分别是“闹钟”、“设置”、“加”、“减”。按下按键的同时我们会听到有“咔嗒”的声音，声音是由震动产生的，这个物理的震动会造成电平切换的时刻，会有电平的抖动，造成单片机的误判断。图4-6为按下按键的瞬间，电平示意图。为了避免这个现象我采用了软件程序消抖的解决方法，如果检测到了按键按下，就等待10ms的时间再进行第二次判断，如果第二次检测到按键仍然是按下的状态，就确认按键按下了，然后等待松手后把键值返回，在主程序中做出相应的处理。图4-7是按键的扫描程序流程图。</p><p><img src="media/50862b21ff143ef487c4417cc73dc1fe.jpg" alt=""></p><p>图4-6</p><p><img src="media/de21a9d69a2b44c9ea9d945bf7d14348.jpg" alt=""></p><p><img src="media/6ac8c575c08630cd79fdf13398761ebe.jpg" alt=""></p><p>图4-7 图4-8</p><h3 id="闹钟检测程序"><a href="#闹钟检测程序" class="headerlink" title="闹钟检测程序"></a>闹钟检测程序</h3><p>在生活中时常会遇到需要短时间定时的场景，比如炖汤要2个小时，开火之后的两个小时可以做别的事情，等带到两个小时以后关火。那么这个闹钟就用起来就非常方便，只需要简单的几下按键操作，即可设定短时间的闹钟，来提醒自己要做的事情。</p><p>进入闹钟检测子程序之后，首先判断闹钟标志位是否打开，如过打开了就把闹钟设定时间和现在时间进行对比，如果现在时间和闹钟设定设定时间一致，就响铃一分钟，然后结束子程序。图4-8是闹钟检测子程序的流程图。</p><h3 id="继电器控制程序"><a href="#继电器控制程序" class="headerlink" title="继电器控制程序"></a>继电器控制程序</h3><p>为了对用家里市电220V电压的电器进行控制，需要用到继电器作为弱电和强电的连接桥梁。在程序中，是通过蓝牙接收主控端或者手机发送来的控制指令，进行判断然再执行相应的动作。</p><p>首先要判断接受标志位，是否收到控制指令。如果收到了指令就判断受到的是什么指令，然后相对应的继电器会执行相应的动作，再进入下一轮的检测识别中，一直循环构成了主程序的检测部分。图4-9是继电器控制部分的流程图。</p><p><img src="media/fdb0fdad4fb930efd753af8c49575638.jpg" alt=""></p><p>图4-9</p><h3 id="LCD显示程序"><a href="#LCD显示程序" class="headerlink" title="LCD显示程序"></a>LCD显示程序</h3><p>为了可以显示时间、温度和闹钟等信息，选择了LCD16×02的液晶作为显示器。该液晶模块的软件操作简单。首先初始化，写入显示模式的指令。由于LCD模块在内部处理信息时，无法处理单片机的数据和指令，这时对外表现出“busy”的状态，所以在单片机对其下一步处理时，需要先进行判忙操作。在单片机读取时间和温度等信息之后，把数据处理后给屏幕显示，等待数据显示完毕结束本轮的显示，自动进入下一轮屏幕扫描。图4-10是LCD显示程序流程图。</p><p><img src="media/2118351f6b35d6e7841c80d4d1b97981.jpg" alt=""></p><p>图4-10</p><h1 id="整体调试与测试"><a href="#整体调试与测试" class="headerlink" title="整体调试与测试"></a>整体调试与测试</h1><h2 id="调试过程"><a href="#调试过程" class="headerlink" title="调试过程"></a>调试过程</h2><p>在制作过程中，遇到了串口接收不到数据的问题，经过细致排查后，发现了两个原因。第一是在程序的编写中，由于轻信STC-ISP波特率计算器软件向导，自己并没有检查代码的完整性。在默认程序中串口中断没有默认打开<br>，导致了接受不到串口数据，经过老师指点和自己探索把这个问题解决了。图5-1是STC-ISP下载软件的波特率计算器界面。</p><p><img src="media/b0672234d6b7b1b6011fb752cd9b8329.jpg" alt=""></p><p>图5-1</p><p>另一个原因是USB-TTL串口线供电会对程的序运行有影响。在使用串口线下载程序时，USB-TTL串口线起到和供电和传输数据两个功能。在只使用USB-TTL串口线供电时，数据功能并没有关闭，电脑端会默认检测串口端的数据变化，并回复ACK信息。由于串口1是复用串口，兼具下载程序和语音识别的功能。在仅仅使用供电功能时，电脑端回复的信息就造成了干扰，导致数据传输不能被正确接收和识别，解决办法是换用电池供电或者纯电源供电。图5-2是电脑、单片机和语音识别模块的连接关系图。</p><p><img src="media/d44402ba4e1cbd509608d6998870d380.jpg" alt=""></p><p>图5-2</p><h2 id="模块的测试"><a href="#模块的测试" class="headerlink" title="模块的测试"></a>模块的测试</h2><p>语音模块配套有上位机软件，用来对语音模块配置和测试。首先编辑需要用到的识别词组，然后点击“生成”按钮，生成bin二进制文件，在语音模块通过USB-TTL线连接电脑后，点“写入”按钮，把程序烧写到模块里。测试时，点击软件界面的“测试”按钮，开始语音识别测试，这时模块上蓝色的LED灯会开始闪烁，代表正在检测语音。如果模块识别到正确词组，软件光标会跳动到该词组所在位置。图x是语音识别模块配套的上位机软件。</p><p><img src="media/20c83d68107fc02b9046a669f076e40d.jpg" alt="2017-02-19\_234226"></p><p><img src="media/783c6f0e88958f6e97aa74c5930f500a.jpg" alt="S70219-231935"></p><blockquote><p> 图5-3 图5-4</p></blockquote><h2 id="手机APP适配"><a href="#手机APP适配" class="headerlink" title="手机APP适配"></a>手机APP适配</h2><p>为了迎合科技的进步与创新，本设计还适配了手机的APP端，在不方便使用语音控制或者主控制端没电等情况时候，可以通过手机APP进行对家居的控制，如图5-4是手机APP端的界面。实现原理是模拟出主控制端与从控制端的蓝牙数据协议，通过手机蓝牙与从控制端进行数据通信，发送相对应的指令控制固定端的继电器状态，进而控制用电器的开关。数据帧格式与主控端一致。</p><h2 id="原理图和PCB图"><a href="#原理图和PCB图" class="headerlink" title="原理图和PCB图"></a>原理图和PCB图</h2><p>Altium<br>Designer是一个集成化EDA设计软件，他可以实现从原理图和仿真，ERC检查，Layout和Router到最后做出gerber文件的全部功能。它有四大设计部分组成，原理图（SCH）设计部分、PCB设计部分、原理图（SCH）仿真部分、可编程逻辑元件（FPGA）设计部分。在本设计中我们用到的是前两个部分的功能。图5-5为Altium<br>Designer软件界面。</p><p><img src="media/4edd522ab4184a993dc2c2038ddbcc06.png" alt=""></p><p>图5-5</p><h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>此设计完整的实现了由单片机控制的语音交互家居控制系统的功能。优点有体积小、可充电设计、环保节能、使用便捷、手机APP适配、可自定义被控制用电器等，对未来智能家居的发展有很大启发作用。</p><p>在本次毕业设计的开发过程中，除了创新和基础知识之外，我觉得个人的动手能力和C语言的水平是项目完成的关键。许多模块都是现在比较成熟的产品，如果缺乏新的思路，也只能重复别人做过的题目，没有一点新意。如果经过了自己认真的思考，斟酌功能的选用，用心去挑选元件和模块，那就可以在已经成熟的旧题目上，展现出自己的闪光点和新意。</p><p>通过本次的设计，自己又有了一些新的心得体会。在大的项目上，代码的规范性至关重要，在后期调试中，如果前期的代码不规范，那就会让代码的调试工作变得非常的困难。在硬件的设计过程中，重要的线路上留下测试点和备用冗余接口，这样系统的可扩展性就增加了，如果后期想增加一些功能模块的话，会方便许多。在硬件的制作过程中，需要很大的耐心，只有把制作PCB板的每一个步骤都严格完成，才能制作出高质量的板子。从整体方面来看，尽量把做过的制作资料和程序整理存档，如果下次的设计用得到，就可以直接拿来就用，省去了很多开发时间。</p><p>在工作面试时，可以直接拿出自己所做出来的一些东西，介绍整体的构思，完成情况，遇到的问题的和解决方法，这样做会为自己的能力加分，增加面试官对自己的印象，让自己成为众多求职者中的佼佼者。</p><h1 id="致-谢"><a href="#致-谢" class="headerlink" title="致 谢"></a>致 谢</h1><p>本人的毕业设计和学位论文是在我的导师周老师的悉心指导下完成的。周老师渊博的专业技能和知识，严谨而又诙谐幽默治学风格，深深的感染和激励着我。在每次设计遇到问题自己又解决不了的时候，周老师不辞辛苦的给我讲解才让我顺利完成毕业设计。从论文的选题到资料搜集直到最后的设计修改，花费了周老师许多宝贵的时间和精力。在此向导师表示崇高的敬意和衷心的感谢！</p><p>四年的大学生活即将结束，回顾几年的历程，老师在学习和未来方向上给了我们很多的指导和帮助。在此，我对所有电子信息工程学院的老师表示感谢，祝你们身体健康，工作顺利！</p><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><p>原理图和PCB图。</p><p>本文永久地址 <a href="http://blog.mapan.win/2017/053.html">http://blog.mapan.win/2017/053.html</a> 转载请保留出处</p></div><div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div> <button id="rewardButton" disable="enable" onclick='var e=document.getElementById("QR");"none"===e.style.display?e.style.display="block":e.style.display="none"'> <span>赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"> <img id="wechat_qr" src="http://oe8149r92.bkt.clouddn.com/payweixin.png" alt="Mapan WeChat Pay"><p>微信打赏</p></div><div id="alipay" style="display:inline-block"> <img id="alipay_qr" src="http://oe8149r92.bkt.clouddn.com/payali.png" alt="Mapan Alipay"><p>支付宝打赏</p></div></div></div></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/论文/" rel="tag">#论文</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/052.html" rel="next" title="Next主题添加鼠标心形点击特效"><i class="fa fa-chevron-left"></i> Next主题添加鼠标心形点击特效</a></div><div class="post-nav-prev post-nav-item"></div></div></footer></article><div class="post-spread"></div></div></div><div class="jiathis_style"><span class="jiathis_txt">分享到:</span><a class="jiathis_button_weixin"></a><a class="jiathis_button_qzone"></a><a class="jiathis_button_cqq"></a><a class="jiathis_button_tsina"></a><a class="jiathis_button_douban"></a><a class="jiathis_button_email"></a><a class="jiathis_button_evernote"></a><a class="jiathis_button_ydnote"></a></div><script type="text/javascript">var jiathis_config={data_track_clickback:!0,sm:"email,tsina,weixin,qzone,cqq,douban,evernote,tieba",summary:"",shortUrl:!1,hideMore:!0}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=2115171" charset="utf-8"></script><div id="uyan_frame"></div><script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2115171"></script><script type="text/javascript">document.getElementById("uyan-copyright").style.display="none"</script></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview"> 站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Mapan"><p class="site-author-name" itemprop="name">Mapan</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives"><span class="site-state-item-count">42</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories"><span class="site-state-item-count">16</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags"><span class="site-state-item-count">29</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" target="_blank" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/mapan2020" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="http://weibo.com/ccmapan" target="_blank" title="微博"><i class="fa fa-fw fa-weibo"></i> 微博</a></span><span class="links-of-author-item"><a href="http://mail.mapan.win" target="_blank" title="mail"><i class="fa fa-fw fa-globe"></i> 邮箱登录</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-globe"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://hexo.github.io/" title="airghc" target="_blank">airghc</a></li><li class="links-of-blogroll-item"> <a href="https://wjcc.cc/" title="纹结" target="_blank">纹结</a></li><li class="links-of-blogroll-item"> <a href="http://ehlxr.me/" title="Ehlxr" target="_blank">Ehlxr</a></li><li class="links-of-blogroll-item"> <a href="https://www.sfantree.com/" title="水番林" target="_blank">水番林</a></li><li class="links-of-blogroll-item"> <a href="http://leeyom.top/" title="leeyom" target="_blank">leeyom</a></li><li class="links-of-blogroll-item"> <a href="http://zcheng.ren/" title="ZeeCoder" target="_blank">ZeeCoder</a></li><li class="links-of-blogroll-item"> <a href="http://fantasticzhang.gtensor.com/" title="fantastic" target="_blank">fantastic</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#绪论"><span class="nav-number">1.</span> <span class="nav-text">绪论</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#研究现状与发展趋势"><span class="nav-number">1.1.</span> <span class="nav-text">研究现状与发展趋势</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#研究背景和设计目的"><span class="nav-number">1.2.</span> <span class="nav-text">研究背景和设计目的</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#总体设计方案"><span class="nav-number">2.</span> <span class="nav-text">总体设计方案</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#设计要求"><span class="nav-number">2.1.</span> <span class="nav-text">设计要求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总体方案"><span class="nav-number">2.2.</span> <span class="nav-text">总体方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结构框图"><span class="nav-number">2.3.</span> <span class="nav-text">结构框图</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#硬件设计"><span class="nav-number">3.</span> <span class="nav-text">硬件设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#主控制端"><span class="nav-number">3.1.</span> <span class="nav-text">主控制端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#主控制器"><span class="nav-number">3.1.1.</span> <span class="nav-text">主控制器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MP3播放模块"><span class="nav-number">3.1.2.</span> <span class="nav-text">MP3播放模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#蓝牙模块"><span class="nav-number">3.1.3.</span> <span class="nav-text">蓝牙模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#时钟模块"><span class="nav-number">3.1.4.</span> <span class="nav-text">时钟模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#语音识别模块"><span class="nav-number">3.1.5.</span> <span class="nav-text">语音识别模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#功放模块"><span class="nav-number">3.1.6.</span> <span class="nav-text">功放模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#电源模块"><span class="nav-number">3.1.7.</span> <span class="nav-text">电源模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#串口复用模块"><span class="nav-number">3.1.8.</span> <span class="nav-text">串口复用模块</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#从控制端"><span class="nav-number">3.2.</span> <span class="nav-text">从控制端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#继电器模块"><span class="nav-number">3.2.1.</span> <span class="nav-text">继电器模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#液晶显示模块"><span class="nav-number">3.2.2.</span> <span class="nav-text">液晶显示模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#时钟模块-1"><span class="nav-number">3.2.3.</span> <span class="nav-text">时钟模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#温度传感器"><span class="nav-number">3.2.4.</span> <span class="nav-text">温度传感器</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#软件设计"><span class="nav-number">4.</span> <span class="nav-text">软件设计</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#主控制端软件设计"><span class="nav-number">4.1.</span> <span class="nav-text">主控制端软件设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#移动端主程序"><span class="nav-number">4.1.1.</span> <span class="nav-text">移动端主程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#循环模式"><span class="nav-number">4.1.2.</span> <span class="nav-text">循环模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#口令模式"><span class="nav-number">4.1.3.</span> <span class="nav-text">口令模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#报时模式"><span class="nav-number">4.1.4.</span> <span class="nav-text">报时模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#从控制端软件设计"><span class="nav-number">4.2.</span> <span class="nav-text">从控制端软件设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#固定端主程序"><span class="nav-number">4.2.1.</span> <span class="nav-text">固定端主程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#按键扫描程序"><span class="nav-number">4.2.2.</span> <span class="nav-text">按键扫描程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#闹钟检测程序"><span class="nav-number">4.2.3.</span> <span class="nav-text">闹钟检测程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#继电器控制程序"><span class="nav-number">4.2.4.</span> <span class="nav-text">继电器控制程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LCD显示程序"><span class="nav-number">4.2.5.</span> <span class="nav-text">LCD显示程序</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#整体调试与测试"><span class="nav-number">5.</span> <span class="nav-text">整体调试与测试</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#调试过程"><span class="nav-number">5.1.</span> <span class="nav-text">调试过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#模块的测试"><span class="nav-number">5.2.</span> <span class="nav-text">模块的测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#手机APP适配"><span class="nav-number">5.3.</span> <span class="nav-text">手机APP适配</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#原理图和PCB图"><span class="nav-number">5.4.</span> <span class="nav-text">原理图和PCB图</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#结论"><span class="nav-number">6.</span> <span class="nav-text">结论</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#致-谢"><span class="nav-number">7.</span> <span class="nav-text">致 谢</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考文献"><span class="nav-number">8.</span> <span class="nav-text">参考文献</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#附录"><span class="nav-number">9.</span> <span class="nav-text">附录</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2015 - 2017 <a class="index-link" href="http://www.mapan.win">mapan.win</a> <span class="site-uv">&nbsp;&nbsp;<i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span><span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script><script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script><script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script><script type="text/javascript" async src="//push.zhanzhang.baidu.com/push.js"></script><script type="text/javascript" src="/js/src/love.js"></script></body></html>